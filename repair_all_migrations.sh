#!/bin/bash

echo "ğŸ”§ Repairing all migration history..."
echo "This will mark all existing migrations as applied without re-running them."

# Array of all migrations that need to be marked as applied
migrations=(
    "20241210000001"
    "20241220000000" 
    "20241220"
    "20250101000002"
    "20250101000003"
    "20250102000000"
    "20250103000000"
    "20250115000000"
    "20250115000001"
    "20250115000002"
    "20250115000003"
    "20250116000000"
    "20250116000001"
    "20250116000002"
    "20250116000003"
    "20250116000004"
    "20250117000000"
    "20250117000001"
    "20250117000002"
    "20250120000000"
    "20250120000001"
    "20250121000000"
    "20250125000000"
    "20250125000001"
    "20250125000002"
    "20250125000003"
    "20250125000004"
    "20250125000005"
    "20250125000006"
    "20250125000007"
    "20250125000008"
    "20250125000009"
    "20250125000010"
    "20250125000011"
    "20250125000012"
    "20250125000013"
    "20250125000014"
    "20250125000015"
    "20250125000016"
    "20250125000017"
    "20250125000018"
    "20250125000019"
    "20250126000000"
    "20250126000001"
    "20250126000002"
    "20250126000003"
    "20250126000020"
    "20250126000021"
    "20250126000022"
    "20250130000000"
    "20250130000001"
    "20250130000002"
    "20250130000003"
    "20250131000000"
    "20250131000002"
    "20250201000000"
    "20250201000001"
    "20250519215540"
    "20250519215547"
    "20250520000000"
    "20250520022401"
    "20250520041907"
    "20250520061657"
    "20250522053630"
    "20250530000000"
    "20250603230019"
    "20250604000235"
    "20250606052948"
    "20250606054530"
    "20250606054531"
    "20250609192305"
    "20250609201905"
    "20250802000000"
    "20250802000001"
    "20250802000002"
    "20251026000000"
    "20251030000000"
    "20251100000000"
    "20251101000000"
    "20251200000000"
    "20251201000000"
    "20251202000000"
    "20251202000001"
    "20251210000000"
    "20251500000000"
    "20260101000000"
    "20260102000000"
)

# Counter for progress
total=${#migrations[@]}
current=0

# Loop through each migration and repair it
for migration in "${migrations[@]}"; do
    current=$((current + 1))
    echo "[$current/$total] Repairing migration: $migration"
    
    npx supabase migration repair --status applied "$migration" 2>/dev/null
    
    if [ $? -eq 0 ]; then
        echo "âœ… Successfully repaired: $migration"
    else
        echo "âš ï¸  Warning: Could not repair $migration (may already be applied or not exist)"
    fi
done

echo ""
echo "ğŸ‰ Migration repair complete!"
echo "ğŸ“‹ Run 'npx supabase migration list' to verify the updated migration history." 